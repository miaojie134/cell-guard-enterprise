import{c as Je,w as Qe,x as ee,y as h,A as me,j as e,D,E as A,G as pe,H as k,I as fe,J as he,K as xe,L as R,N as Ze,O as ge,Q as et,T as tt,W as st,X as rt,Y as ve,s as te,B as z,Z as nt,_ as at,r as $,$ as ot,a0 as it,a1 as ct,u as lt,a2 as w,a3 as dt,a4 as ut,M as mt,C as _,g as I,a5 as ie,d as B,e as F,t as ce,a6 as X,a7 as E,U as le,a8 as pt,a9 as ft,aa as de,ab as ue,q as ht,ac as G}from"./index-DoQD9WJV.js";import{C as xt}from"./checkbox-p1vnn6hU.js";import{v as gt}from"./verificationService-CgJXCeex.js";import{A as vt}from"./arrow-left-CHN5ChMN.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=Je("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var je=["PageUp","PageDown"],ye=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],be={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},L="Slider",[J,yt,bt]=Qe(L),[Ne,es]=ee(L,[bt]),[Nt,U]=Ne(L),Se=h.forwardRef((t,s)=>{const{name:r,min:n=0,max:c=100,step:l=1,orientation:o="horizontal",disabled:u=!1,minStepsBetweenThumbs:m=0,defaultValue:f=[n],value:v,onValueChange:d=()=>{},onValueCommit:x=()=>{},inverted:g=!1,form:j,...a}=t,i=h.useRef(new Set),p=h.useRef(0),y=o==="horizontal"?St:wt,[b=[],V]=me({prop:v,defaultProp:f,onChange:S=>{var M;(M=[...i.current][p.current])==null||M.focus(),d(S)}}),Y=h.useRef(b);function W(S){const C=Pt(b,S);K(S,C)}function qe(S){K(S,p.current)}function Xe(){const S=Y.current[p.current];b[p.current]!==S&&x(b)}function K(S,C,{commit:M}={commit:!1}){const ae=kt(l),q=Mt(Math.round((S-n)/l)*l+n,ae),O=xe(q,[n,c]);V((T=[])=>{const P=Rt(T,O,C);if(At(P,m*l)){p.current=P.indexOf(O);const oe=String(P)!==String(T);return oe&&M&&x(P),oe?P:T}else return T})}return e.jsx(Nt,{scope:t.__scopeSlider,name:r,disabled:u,min:n,max:c,valueIndexToChangeRef:p,thumbs:i.current,values:b,orientation:o,form:j,children:e.jsx(J.Provider,{scope:t.__scopeSlider,children:e.jsx(J.Slot,{scope:t.__scopeSlider,children:e.jsx(y,{"aria-disabled":u,"data-disabled":u?"":void 0,...a,ref:s,onPointerDown:D(a.onPointerDown,()=>{u||(Y.current=b)}),min:n,max:c,inverted:g,onSlideStart:u?void 0:W,onSlideMove:u?void 0:qe,onSlideEnd:u?void 0:Xe,onHomeKeyDown:()=>!u&&K(n,0,{commit:!0}),onEndKeyDown:()=>!u&&K(c,b.length-1,{commit:!0}),onStepKeyDown:({event:S,direction:C})=>{if(!u){const q=je.includes(S.key)||S.shiftKey&&ye.includes(S.key)?10:1,O=p.current,T=b[O],P=l*q*C;K(T+P,O,{commit:!0})}}})})})})});Se.displayName=L;var[we,Ee]=Ne(L,{startEdge:"left",endEdge:"right",size:"width",direction:1}),St=h.forwardRef((t,s)=>{const{min:r,max:n,dir:c,inverted:l,onSlideStart:o,onSlideMove:u,onSlideEnd:m,onStepKeyDown:f,...v}=t,[d,x]=h.useState(null),g=A(s,y=>x(y)),j=h.useRef(),a=pe(c),i=a==="ltr",p=i&&!l||!i&&l;function N(y){const b=j.current||d.getBoundingClientRect(),V=[0,b.width],W=se(V,p?[r,n]:[n,r]);return j.current=b,W(y-b.left)}return e.jsx(we,{scope:t.__scopeSlider,startEdge:p?"left":"right",endEdge:p?"right":"left",direction:p?1:-1,size:"width",children:e.jsx(De,{dir:a,"data-orientation":"horizontal",...v,ref:g,style:{...v.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:y=>{const b=N(y.clientX);o==null||o(b)},onSlideMove:y=>{const b=N(y.clientX);u==null||u(b)},onSlideEnd:()=>{j.current=void 0,m==null||m()},onStepKeyDown:y=>{const V=be[p?"from-left":"from-right"].includes(y.key);f==null||f({event:y,direction:V?-1:1})}})})}),wt=h.forwardRef((t,s)=>{const{min:r,max:n,inverted:c,onSlideStart:l,onSlideMove:o,onSlideEnd:u,onStepKeyDown:m,...f}=t,v=h.useRef(null),d=A(s,v),x=h.useRef(),g=!c;function j(a){const i=x.current||v.current.getBoundingClientRect(),p=[0,i.height],y=se(p,g?[n,r]:[r,n]);return x.current=i,y(a-i.top)}return e.jsx(we,{scope:t.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1,children:e.jsx(De,{"data-orientation":"vertical",...f,ref:d,style:{...f.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:a=>{const i=j(a.clientY);l==null||l(i)},onSlideMove:a=>{const i=j(a.clientY);o==null||o(i)},onSlideEnd:()=>{x.current=void 0,u==null||u()},onStepKeyDown:a=>{const p=be[g?"from-bottom":"from-top"].includes(a.key);m==null||m({event:a,direction:p?-1:1})}})})}),De=h.forwardRef((t,s)=>{const{__scopeSlider:r,onSlideStart:n,onSlideMove:c,onSlideEnd:l,onHomeKeyDown:o,onEndKeyDown:u,onStepKeyDown:m,...f}=t,v=U(L,r);return e.jsx(k.span,{...f,ref:s,onKeyDown:D(t.onKeyDown,d=>{d.key==="Home"?(o(d),d.preventDefault()):d.key==="End"?(u(d),d.preventDefault()):je.concat(ye).includes(d.key)&&(m(d),d.preventDefault())}),onPointerDown:D(t.onPointerDown,d=>{const x=d.target;x.setPointerCapture(d.pointerId),d.preventDefault(),v.thumbs.has(x)?x.focus():n(d)}),onPointerMove:D(t.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&c(d)}),onPointerUp:D(t.onPointerUp,d=>{const x=d.target;x.hasPointerCapture(d.pointerId)&&(x.releasePointerCapture(d.pointerId),l(d))})})}),Re="SliderTrack",Ce=h.forwardRef((t,s)=>{const{__scopeSlider:r,...n}=t,c=U(Re,r);return e.jsx(k.span,{"data-disabled":c.disabled?"":void 0,"data-orientation":c.orientation,...n,ref:s})});Ce.displayName=Re;var Q="SliderRange",Pe=h.forwardRef((t,s)=>{const{__scopeSlider:r,...n}=t,c=U(Q,r),l=Ee(Q,r),o=h.useRef(null),u=A(s,o),m=c.values.length,f=c.values.map(x=>Ie(x,c.min,c.max)),v=m>1?Math.min(...f):0,d=100-Math.max(...f);return e.jsx(k.span,{"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,...n,ref:u,style:{...t.style,[l.startEdge]:v+"%",[l.endEdge]:d+"%"}})});Pe.displayName=Q;var Z="SliderThumb",_e=h.forwardRef((t,s)=>{const r=yt(t.__scopeSlider),[n,c]=h.useState(null),l=A(s,u=>c(u)),o=h.useMemo(()=>n?r().findIndex(u=>u.ref.current===n):-1,[r,n]);return e.jsx(Et,{...t,ref:l,index:o})}),Et=h.forwardRef((t,s)=>{const{__scopeSlider:r,index:n,name:c,...l}=t,o=U(Z,r),u=Ee(Z,r),[m,f]=h.useState(null),v=A(s,N=>f(N)),d=m?o.form||!!m.closest("form"):!0,x=fe(m),g=o.values[n],j=g===void 0?0:Ie(g,o.min,o.max),a=Ct(n,o.values.length),i=x==null?void 0:x[u.size],p=i?_t(i,j,u.direction):0;return h.useEffect(()=>{if(m)return o.thumbs.add(m),()=>{o.thumbs.delete(m)}},[m,o.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[u.startEdge]:`calc(${j}% + ${p}px)`},children:[e.jsx(J.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(k.span,{role:"slider","aria-label":t["aria-label"]||a,"aria-valuemin":o.min,"aria-valuenow":g,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...l,ref:v,style:g===void 0?{display:"none"}:t.style,onFocus:D(t.onFocus,()=>{o.valueIndexToChangeRef.current=n})})}),d&&e.jsx(Dt,{name:c??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:g},n)]})});_e.displayName=Z;var Dt=t=>{const{value:s,...r}=t,n=h.useRef(null),c=he(s);return h.useEffect(()=>{const l=n.current,o=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(o,"value").set;if(c!==s&&m){const f=new Event("input",{bubbles:!0});m.call(l,s),l.dispatchEvent(f)}},[c,s]),e.jsx("input",{style:{display:"none"},...r,ref:n,defaultValue:s})};function Rt(t=[],s,r){const n=[...t];return n[r]=s,n.sort((c,l)=>c-l)}function Ie(t,s,r){const l=100/(r-s)*(t-s);return xe(l,[0,100])}function Ct(t,s){return s>2?`Value ${t+1} of ${s}`:s===2?["Minimum","Maximum"][t]:void 0}function Pt(t,s){if(t.length===1)return 0;const r=t.map(c=>Math.abs(c-s)),n=Math.min(...r);return r.indexOf(n)}function _t(t,s,r){const n=t/2,l=se([0,50],[0,n]);return(n-l(s)*r)*r}function It(t){return t.slice(0,-1).map((s,r)=>t[r+1]-s)}function At(t,s){if(s>0){const r=It(t);return Math.min(...r)>=s}return!0}function se(t,s){return r=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const n=(s[1]-s[0])/(t[1]-t[0]);return s[0]+n*(r-t[0])}}function kt(t){return(String(t).split(".")[1]||"").length}function Mt(t,s){const r=Math.pow(10,s);return Math.round(t*r)/r}var Ae=Se,Tt=Ce,Lt=Pe,Vt=_e;const ke=h.forwardRef(({className:t,...s},r)=>e.jsxs(Ae,{ref:r,className:R("relative flex w-full touch-none select-none items-center",t),...s,children:[e.jsx(Tt,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Lt,{className:"absolute h-full bg-primary"})}),e.jsx(Vt,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));ke.displayName=Ae.displayName;var re="Radio",[Kt,Me]=ee(re),[Ot,Bt]=Kt(re),Te=h.forwardRef((t,s)=>{const{__scopeRadio:r,name:n,checked:c=!1,required:l,disabled:o,value:u="on",onCheck:m,form:f,...v}=t,[d,x]=h.useState(null),g=A(s,i=>x(i)),j=h.useRef(!1),a=d?f||!!d.closest("form"):!0;return e.jsxs(Ot,{scope:r,checked:c,disabled:o,children:[e.jsx(k.button,{type:"button",role:"radio","aria-checked":c,"data-state":Ke(c),"data-disabled":o?"":void 0,disabled:o,value:u,...v,ref:g,onClick:D(t.onClick,i=>{c||m==null||m(),a&&(j.current=i.isPropagationStopped(),j.current||i.stopPropagation())})}),a&&e.jsx(Ft,{control:d,bubbles:!j.current,name:n,value:u,checked:c,required:l,disabled:o,form:f,style:{transform:"translateX(-100%)"}})]})});Te.displayName=re;var Le="RadioIndicator",Ve=h.forwardRef((t,s)=>{const{__scopeRadio:r,forceMount:n,...c}=t,l=Bt(Le,r);return e.jsx(Ze,{present:n||l.checked,children:e.jsx(k.span,{"data-state":Ke(l.checked),"data-disabled":l.disabled?"":void 0,...c,ref:s})})});Ve.displayName=Le;var Ft=t=>{const{control:s,checked:r,bubbles:n=!0,...c}=t,l=h.useRef(null),o=he(r),u=fe(s);return h.useEffect(()=>{const m=l.current,f=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(f,"checked").set;if(o!==r&&d){const x=new Event("click",{bubbles:n});d.call(m,r),m.dispatchEvent(x)}},[o,r,n]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:r,...c,tabIndex:-1,ref:l,style:{...t.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Ke(t){return t?"checked":"unchecked"}var Gt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ne="RadioGroup",[$t,ts]=ee(ne,[ge,Me]),Oe=ge(),Be=Me(),[zt,Ht]=$t(ne),Fe=h.forwardRef((t,s)=>{const{__scopeRadioGroup:r,name:n,defaultValue:c,value:l,required:o=!1,disabled:u=!1,orientation:m,dir:f,loop:v=!0,onValueChange:d,...x}=t,g=Oe(r),j=pe(f),[a,i]=me({prop:l,defaultProp:c,onChange:d});return e.jsx(zt,{scope:r,name:n,required:o,disabled:u,value:a,onValueChange:i,children:e.jsx(et,{asChild:!0,...g,orientation:m,dir:j,loop:v,children:e.jsx(k.div,{role:"radiogroup","aria-required":o,"aria-orientation":m,"data-disabled":u?"":void 0,dir:j,...x,ref:s})})})});Fe.displayName=ne;var Ge="RadioGroupItem",$e=h.forwardRef((t,s)=>{const{__scopeRadioGroup:r,disabled:n,...c}=t,l=Ht(Ge,r),o=l.disabled||n,u=Oe(r),m=Be(r),f=h.useRef(null),v=A(s,f),d=l.value===c.value,x=h.useRef(!1);return h.useEffect(()=>{const g=a=>{Gt.includes(a.key)&&(x.current=!0)},j=()=>x.current=!1;return document.addEventListener("keydown",g),document.addEventListener("keyup",j),()=>{document.removeEventListener("keydown",g),document.removeEventListener("keyup",j)}},[]),e.jsx(tt,{asChild:!0,...u,focusable:!o,active:d,children:e.jsx(Te,{disabled:o,required:l.required,checked:d,...m,...c,name:l.name,ref:v,onCheck:()=>l.onValueChange(c.value),onKeyDown:D(g=>{g.key==="Enter"&&g.preventDefault()}),onFocus:D(c.onFocus,()=>{var g;x.current&&((g=f.current)==null||g.click())})})})});$e.displayName=Ge;var Ut="RadioGroupIndicator",ze=h.forwardRef((t,s)=>{const{__scopeRadioGroup:r,...n}=t,c=Be(r);return e.jsx(Ve,{...c,...n,ref:s})});ze.displayName=Ut;var He=Fe,Ue=$e,Yt=ze;const Ye=h.forwardRef(({className:t,...s},r)=>e.jsx(He,{className:R("grid gap-2",t),...s,ref:r}));Ye.displayName=He.displayName;const H=h.forwardRef(({className:t,...s},r)=>e.jsx(Ue,{ref:r,className:R("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(Yt,{className:"flex items-center justify-center",children:e.jsx(st,{className:"h-2.5 w-2.5 fill-current text-current"})})}));H.displayName=Ue.displayName;const Wt=(t,s)=>t===0?it:s?te:ct,We=({node:t,level:s,isLast:r=!1,parentIsLast:n=[],selectedDepartmentIds:c,onDepartmentChange:l,activeEmployees:o=[]})=>{const[u,m]=h.useState(!1),f=t.children&&t.children.length>0,v=c.includes(t.id.toString()),d=o.filter(i=>{const p=i.department;return!!(p===t.name||p.endsWith(t.name)||p.startsWith(t.name+" >"))}),x=d.length;t.name.includes("产研中心")&&console.log(`部门 "${t.name}" 的员工匹配情况:`,{departmentName:t.name,matchingEmployees:d.map(i=>i.department),employeeCount:x,testMatches:o.slice(0,5).map(i=>({empDept:i.department,endsWith:i.department.endsWith(t.name),startsWith:i.department.startsWith(t.name+" >"),exact:i.department===t.name}))});const g=()=>{f&&m(!u)},j=i=>{l(t.id.toString(),i,t.name)},a=Wt(s,f);return e.jsxs("div",{className:"relative",children:[s>0&&e.jsxs(e.Fragment,{children:[n.map((i,p)=>e.jsx("div",{className:R("absolute w-0.5 bg-border/30",!i&&"h-full"),style:{left:`${22+p*28}px`,top:p===n.length-1?"0":"-12px",height:p===n.length-1?"20px":"calc(100% + 12px)"}},p)),e.jsx("div",{className:"absolute h-0.5 bg-border/30",style:{left:`${22+(s-1)*28}px`,top:"19px",width:"16px"}})]}),e.jsxs("div",{className:R("flex items-center gap-3 py-2 pr-3 rounded-lg transition-all duration-200","group relative z-10 bg-background","hover:bg-accent/30",v&&"bg-primary/5 border border-primary/20"),style:{marginLeft:s>0?`${20+s*28}px`:"0px",paddingLeft:"8px"},children:[e.jsx(z,{variant:"ghost",size:"sm",className:R("h-5 w-5 p-0 rounded-full transition-all duration-200","hover:bg-accent",f?"opacity-100":"opacity-0 pointer-events-none"),onClick:g,disabled:!f,children:f&&(u?e.jsx(nt,{className:"h-3 w-3"}):e.jsx(at,{className:"h-3 w-3"}))}),e.jsx(xt,{id:`dept-${t.id}`,checked:v,onCheckedChange:j,className:"data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),e.jsx("div",{className:R("flex items-center justify-center w-7 h-7 rounded-full border bg-background",t.isActive?"border-primary/30 text-primary":"border-muted-foreground/20 text-muted-foreground"),children:e.jsx(a,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:`dept-${t.id}`,className:R("font-medium truncate cursor-pointer transition-colors duration-200",s===0?"text-base":"text-sm",t.isActive?"text-foreground hover:text-primary":"text-muted-foreground"),children:t.name}),e.jsx($,{variant:"outline",className:"text-xs h-5 px-1.5",children:x}),!t.isActive&&e.jsx($,{variant:"secondary",className:"text-xs h-5 bg-orange-100 text-orange-700 border-orange-200",children:"停用"}),f&&e.jsx($,{variant:"outline",className:"text-xs h-5 bg-blue-50 text-blue-700 border-blue-200",children:t.children.length})]}),t.description&&e.jsx("div",{className:"text-xs text-muted-foreground/70 truncate mt-0.5",children:t.description})]})]}),f&&u&&e.jsx("div",{className:"relative mt-1",children:t.children.map((i,p)=>e.jsx(We,{node:i,level:s+1,isLast:p===t.children.length-1,parentIsLast:[...n,r],selectedDepartmentIds:c,onDepartmentChange:l,activeEmployees:o},i.id))})]})},qt=({selectedDepartmentIds:t,onDepartmentChange:s,activeEmployees:r=[]})=>{const{tree:n,isLoading:c,error:l}=rt(),{user:o}=ve(),u=f=>f.filter(v=>ot(o,v.id)?(v.children=u(v.children),!0):!1),m=n?u(n):[];return c?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"加载部门树..."})]})}):l?e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-sm text-red-500",children:l})}):!m||m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(te,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n&&n.length>0?"暂无有权限访问的部门":"暂无部门数据"})]}):e.jsx("div",{className:"space-y-1 bg-muted/20 rounded-lg p-3 max-h-64 overflow-y-auto",children:m.map((f,v)=>e.jsx(We,{node:f,level:0,isLast:v===m.length-1,parentIsLast:[],selectedDepartmentIds:t,onDepartmentChange:s,activeEmployees:r},f.id))})},ss=()=>{const t=lt();ve();const[s,r]=h.useState({scope:w.ALL_USERS,selectedDepartments:[],selectedDepartmentNames:[],selectedEmployees:[],durationDays:7,previewEnabled:!1}),{activeEmployees:n,isLoading:c}=dt({employmentStatus:"Active",limit:1e3}),l=ut({mutationFn:a=>gt.initiate(a),onSuccess:a=>{G({title:"盘点任务已发起",description:"批处理任务已创建，正在发送邮件通知"}),t(`/verification/batch/${a.batchId}`)},onError:a=>{G({title:"发起失败",description:a instanceof Error?a.message:"发起盘点失败，请稍后重试",variant:"destructive"})}}),o=a=>{r(i=>({...i,scope:a,selectedDepartments:[],selectedDepartmentNames:[],selectedEmployees:[]}))},u=(a,i,p)=>{r(N=>({...N,selectedDepartments:i?[...N.selectedDepartments,a]:N.selectedDepartments.filter(y=>y!==a),selectedDepartmentNames:i?[...N.selectedDepartmentNames,p||""]:N.selectedDepartmentNames.filter(y=>y!==p)}))},m=a=>{if(!a)return;if(s.selectedEmployees.some(p=>p.id===a.id)){G({title:"重复选择",description:"该员工已经被选择",variant:"destructive"});return}r(p=>({...p,selectedEmployees:[...p.selectedEmployees,a]}))},f=a=>{r(i=>({...i,selectedEmployees:i.selectedEmployees.filter(p=>p.id!==a)}))},v=()=>{if(s.selectedDepartmentNames.length===0)return 0;const a=n.filter(i=>{const p=i.department;return s.selectedDepartmentNames.some(N=>!!(p===N||p.endsWith(N)||p.startsWith(N+" >")))});return console.log("选中部门员工计算:",{selectedDepartmentNames:s.selectedDepartmentNames,totalEmployees:n.length,allEmployeeDepartments:n.map(i=>i.department),matchingEmployees:a.map(i=>i.department),finalCount:a.length}),a.length},d=()=>{switch(s.scope){case w.ALL_USERS:return{title:"全员盘点",count:n.length,description:"将向所有在职员工发送确认邮件"};case w.DEPARTMENT_IDS:const a=s.selectedDepartments.length;return{title:"按部门盘点",count:v(),description:a>0?`选中部门：${s.selectedDepartmentNames.join("、")}`:"请选择要盘点的部门"};case w.EMPLOYEE_IDS:return{title:"按员工盘点",count:s.selectedEmployees.length,description:`已选择 ${s.selectedEmployees.length} 位员工`};default:return{title:"",count:0,description:""}}},x=()=>s.scope===w.DEPARTMENT_IDS&&s.selectedDepartments.length===0?(G({title:"表单验证失败",description:"请至少选择一个部门",variant:"destructive"}),!1):s.scope===w.EMPLOYEE_IDS&&s.selectedEmployees.length===0?(G({title:"表单验证失败",description:"请至少选择一个员工",variant:"destructive"}),!1):!0,g=()=>{if(!x())return;const a={scope:s.scope,durationDays:s.durationDays};s.scope===w.DEPARTMENT_IDS?a.scopeValues=s.selectedDepartments:s.scope===w.EMPLOYEE_IDS&&(a.scopeValues=s.selectedEmployees.map(i=>i.employeeId)),l.mutate(a)},j=d();return e.jsx(mt,{title:"发起盘点",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>t("/verification"),className:"p-1",children:e.jsx(vt,{className:"h-4 w-4"})}),e.jsx("p",{className:"text-muted-foreground",children:"创建新的手机号码使用确认任务"})]})})}),c?e.jsx(_,{children:e.jsx(I,{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ie,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"正在加载数据..."})]})})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs(_,{children:[e.jsxs(B,{className:"pb-3",children:[e.jsxs(F,{className:"flex items-center text-lg",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"盘点范围"]}),e.jsx(X,{className:"text-sm",children:"选择需要进行盘点的人员范围"})]}),e.jsx(I,{className:"space-y-3",children:e.jsxs(Ye,{value:s.scope,onValueChange:o,className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{value:w.ALL_USERS,id:"all"}),e.jsxs(E,{htmlFor:"all",className:"flex items-center cursor-pointer text-sm",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"全员盘点",e.jsxs($,{variant:"outline",className:"ml-2 text-xs",children:[n.length," 人"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{value:w.DEPARTMENT_IDS,id:"departments"}),e.jsxs(E,{htmlFor:"departments",className:"flex items-center cursor-pointer text-sm",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"按部门盘点"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{value:w.EMPLOYEE_IDS,id:"employees"}),e.jsxs(E,{htmlFor:"employees",className:"flex items-center cursor-pointer text-sm",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"按员工盘点"]})]})]})})]}),s.scope===w.DEPARTMENT_IDS&&e.jsxs(_,{children:[e.jsxs(B,{className:"pb-3",children:[e.jsx(F,{className:"text-lg",children:"选择部门"}),e.jsx(X,{className:"text-sm",children:"请选择需要进行盘点的部门"})]}),e.jsx(I,{children:e.jsx(qt,{selectedDepartmentIds:s.selectedDepartments,onDepartmentChange:u,activeEmployees:n})})]}),s.scope===w.EMPLOYEE_IDS&&e.jsxs(_,{children:[e.jsx(B,{className:"pb-3",children:e.jsx(F,{className:"text-lg",children:"选择员工"})}),e.jsxs(I,{className:"space-y-3",children:[e.jsx("div",{children:e.jsx(pt,{value:null,onChange:m,placeholder:"搜索员工姓名或部门...",compact:!0,enableDynamicSearch:!0})}),s.selectedEmployees.length>0&&e.jsxs("div",{children:[e.jsxs(E,{className:"text-sm",children:["已选择的员工 (",s.selectedEmployees.length,"人)"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.selectedEmployees.map(a=>e.jsxs($,{variant:"secondary",className:"flex items-center gap-1 px-2 py-1 text-xs",children:[e.jsx("span",{children:a.fullName}),e.jsxs("span",{className:"text-muted-foreground",children:["(",a.employeeId,")"]}),e.jsx(z,{variant:"ghost",size:"sm",className:"h-3 w-3 p-0 ml-1 hover:bg-destructive hover:text-destructive-foreground",onClick:()=>f(a.id),children:e.jsx(ft,{className:"h-2 w-2"})})]},a.id))})]}),s.selectedEmployees.length===0&&e.jsxs(de,{className:"py-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx(ue,{className:"text-sm",children:"请使用上方搜索框搜索并选择员工。支持按姓名、部门等搜索。"})]})]})]}),e.jsxs(_,{children:[e.jsxs(B,{className:"pb-3",children:[e.jsxs(F,{className:"flex items-center text-lg",children:[e.jsx(ht,{className:"h-4 w-4 mr-2"}),"有效期设置"]}),e.jsx(X,{className:"text-sm",children:"设置确认链接的有效期，过期后员工将无法提交确认"})]}),e.jsxs(I,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs(E,{className:"text-sm",children:["有效期：",s.durationDays," 天"]}),e.jsx(ke,{value:[s.durationDays],onValueChange:a=>r(i=>({...i,durationDays:a[0]})),max:30,min:1,step:1,className:"mt-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"1天"}),e.jsx("span",{children:"30天"})]})]}),e.jsx(de,{className:"py-2",children:e.jsxs(ue,{className:"text-sm",children:["截止时间：",(()=>{const a=new Date;return a.setDate(a.getDate()+s.durationDays),a.setHours(23,59,59,999),a.toLocaleString("zh-CN")})()]})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{children:[e.jsx(B,{className:"pb-3",children:e.jsx(F,{className:"text-lg",children:"预览信息"})}),e.jsxs(I,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"盘点类型"}),e.jsx("p",{className:"text-base font-medium",children:j.title})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"目标人数"}),e.jsxs("p",{className:"text-xl font-bold text-blue-600",children:[j.count," 人"]})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"描述"}),e.jsx("p",{className:"text-sm text-gray-600",children:j.description})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"有效期"}),e.jsxs("p",{className:"text-sm",children:[s.durationDays," 天"]})]})]})]}),e.jsx(_,{children:e.jsxs(I,{className:"pt-4",children:[e.jsxs(z,{onClick:g,disabled:l.isPending||j.count===0,className:"w-full",size:"lg",children:[l.isPending&&e.jsx(ie,{className:"h-4 w-4 mr-2 animate-spin"}),e.jsx(jt,{className:"h-4 w-4 mr-2"}),"发起盘点"]}),j.count===0&&e.jsx("p",{className:"text-xs text-red-600 mt-2 text-center",children:"请选择至少一个盘点目标"})]})})]})]})]})})};export{ss as default};
