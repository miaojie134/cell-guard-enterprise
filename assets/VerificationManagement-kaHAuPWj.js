import{c as C,u as H,a as G,R as p,b as V,V as c,j as e,M as U,C as x,d as j,e as g,f as T,g as m,P as D,F as W,S as X,h as K,i as Q,k as Y,l as N,m as J,n as Z,B as d,o as ee,p as se,z as y,q as te,r as u,U as ae,s as re,t as le,v as w}from"./index-DoQD9WJV.js";import{v as ce}from"./verificationService-CgJXCeex.js";import{C as ne,a as ie}from"./clock-CMK8JJyI.js";import{C as de}from"./chart-column-BIE7iFok.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=C("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=C("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=C("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=C("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),je=()=>{const S=H();G();const[r,M]=p.useState("30d"),[a,E]=p.useState({}),[n,f]=p.useState({}),[O,v]=p.useState(!1),P=()=>{const s=new Date;let t,l;switch(r){case"7d":t=new Date(s.getTime()-7*24*60*60*1e3).toISOString();break;case"30d":t=new Date(s.getTime()-30*24*60*60*1e3).toISOString();break;case"90d":t=new Date(s.getTime()-90*24*60*60*1e3).toISOString();break;case"custom":if(a.from&&(t=a.from.toISOString()),a.to){const h=new Date(a.to);h.setHours(23,59,59,999),l=h.toISOString()}break;case"all":default:t=void 0,l=void 0;break}return{createdAfter:t,createdBefore:l}},{data:i=[],isLoading:_}=V({queryKey:["verification-batches",r,a.from,a.to],queryFn:()=>{const{createdAfter:s,createdBefore:t}=P();return ce.getBatchList({limit:50,sortBy:"createdAt",sortOrder:"desc",...s&&{createdAfter:s},...t&&{createdBefore:t}})},refetchInterval:s=>{const t=s.state.data;return t&&t.some(l=>l.status===c.PENDING||l.status===c.IN_PROGRESS)?1e4:!1}}),b=p.useMemo(()=>{const s=i.length,t=i.filter(o=>o.status===c.PENDING||o.status===c.IN_PROGRESS).length,l=i.filter(o=>o.status===c.COMPLETED).length,h=i.filter(o=>o.status===c.FAILED||o.status===c.COMPLETED_WITH_ERRORS).length;return{total:s,inProgress:t,completed:l,failed:h}},[i]),k=()=>{S("/verification/create")},z=()=>{S("/verification/results")},L=s=>{S(`/verification/batch/${s}`)},$=s=>{switch(s){case c.PENDING:return e.jsx(u,{variant:"secondary",children:"等待中"});case c.IN_PROGRESS:return e.jsx(u,{variant:"default",className:"bg-orange-500",children:"进行中"});case c.COMPLETED:return e.jsx(u,{variant:"default",className:"bg-green-500",children:"已完成"});case c.COMPLETED_WITH_ERRORS:return e.jsx(u,{variant:"destructive",children:"完成(有错误)"});case c.FAILED:return e.jsx(u,{variant:"destructive",children:"失败"});default:return e.jsx(u,{variant:"outline",children:s})}},B=(s,t)=>{switch(s){case"all_users":return{icon:le,text:"全员盘点"};case"department_ids":const l=t?t.split(",").length:0;return{icon:re,text:`按部门盘点 (${l}个部门)`};case"employee_ids":const h=t?t.split(",").length:0;return{icon:ae,text:`按员工盘点 (${h}位员工)`};default:return{icon:T,text:s}}},I=s=>{M(s),s!=="custom"&&(E({}),f({}))},F=()=>{E(n),r!=="custom"&&M("custom"),v(!1)},A=()=>{if(!a.from&&!a.to)return"选择日期范围";const s=a.from?w(a.from,"yyyy-MM-dd",{locale:y}):"",t=a.to?w(a.to,"yyyy-MM-dd",{locale:y}):"";return s&&t?`${s} 至 ${t}`:s?`从 ${s} 开始`:t?`到 ${t} 结束`:"选择日期范围"},q=()=>{if(!n.from&&!n.to)return"选择日期范围";const s=n.from?w(n.from,"yyyy-MM-dd",{locale:y}):"",t=n.to?w(n.to,"yyyy-MM-dd",{locale:y}):"";return s&&t?`${s} 至 ${t}`:s?`从 ${s} 开始`:t?`到 ${t} 结束`:"选择日期范围"};return e.jsx(U,{title:"手机号码盘点管理",children:e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"盘点流程发起和查看盘点结果"})})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(x,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[e.jsx(g,{className:"text-sm font-medium",children:"总任务数"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{className:"pb-3",children:[e.jsx("div",{className:"text-2xl font-bold",children:b.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"历史总计"})]})]}),e.jsxs(x,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[e.jsx(g,{className:"text-sm font-medium",children:"进行中"}),e.jsx(ne,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(m,{className:"pb-3",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:b.inProgress}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"正在执行的任务"})]})]}),e.jsxs(x,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[e.jsx(g,{className:"text-sm font-medium",children:"已完成"}),e.jsx(ie,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(m,{className:"pb-3",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:b.completed}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"成功完成的任务"})]})]}),e.jsxs(x,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[e.jsx(g,{className:"text-sm font-medium",children:"失败"}),e.jsx(xe,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(m,{className:"pb-3",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:b.failed}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"执行失败的任务"})]})]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2",children:[e.jsx(x,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:k,children:e.jsxs(m,{className:"flex flex-col items-center justify-center p-5",children:[e.jsx("div",{className:"rounded-full bg-blue-100 p-2 mb-3",children:e.jsx(D,{className:"h-6 w-6 text-blue-600"})}),e.jsx("h3",{className:"text-base font-semibold mb-2",children:"发起新盘点"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"创建新的手机号码使用确认任务"})]})}),e.jsx(x,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:z,children:e.jsxs(m,{className:"flex flex-col items-center justify-center p-5",children:[e.jsx("div",{className:"rounded-full bg-green-100 p-2 mb-3",children:e.jsx(de,{className:"h-6 w-6 text-green-600"})}),e.jsx("h3",{className:"text-base font-semibold mb-2",children:"查看盘点结果"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"查看已完成盘点的详细结果和统计"})]})})]}),e.jsxs(x,{children:[e.jsx(j,{className:"pb-4",children:e.jsx("div",{className:"flex flex-col space-y-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(g,{className:"text-base",children:"盘点任务历史"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(X,{value:r,onValueChange:s=>I(s),children:[e.jsx(K,{className:"w-28 h-8 text-xs",children:e.jsx(Q,{placeholder:"选择时间"})}),e.jsxs(Y,{children:[e.jsx(N,{value:"7d",children:"最近7天"}),e.jsx(N,{value:"30d",children:"最近30天"}),e.jsx(N,{value:"90d",children:"最近90天"}),e.jsx(N,{value:"all",children:"全部时间"}),e.jsx(N,{value:"custom",children:"自定义时间"})]})]}),e.jsxs(J,{open:O,onOpenChange:v,children:[e.jsx(Z,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:"h-8 px-2 text-xs min-w-16 max-w-none",onClick:()=>{f(a),v(!0)},children:[e.jsx(oe,{className:"h-3 w-3 mr-1 flex-shrink-0"}),e.jsx("span",{children:r==="custom"&&(a.from||a.to)?A():"自定义"})]})}),e.jsx(ee,{className:"w-auto p-2",align:"end",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-medium text-center border-b pb-1",children:n.from||n.to?e.jsxs("span",{children:["选择: ",q()]}):e.jsx("span",{children:"请选择日期范围"})}),e.jsx(se,{mode:"range",selected:n,onSelect:s=>{f(s?{from:s.from,to:s.to}:{})},locale:y,numberOfMonths:1,className:"rounded-md border p-1",classNames:{head_cell:"text-muted-foreground rounded-md w-8 font-normal text-xs",cell:"h-8 w-8 text-center text-xs p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:"h-8 w-8 p-0 font-normal text-xs aria-selected:opacity-100",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-xs font-medium",nav_button:"h-6 w-6 bg-transparent p-0 opacity-50 hover:opacity-100",table:"w-full border-collapse space-y-1",row:"flex w-full mt-1"}}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{f({})},className:"flex-1 h-6 text-xs px-1",children:"清空"}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>v(!1),className:"flex-1 h-6 text-xs px-1",children:"取消"}),e.jsx(d,{size:"sm",onClick:F,className:"flex-1 h-6 text-xs px-1",disabled:!n.from,children:"应用"})]})]})})]})]})]})})}),e.jsx(m,{className:"pt-0",children:_?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"加载中..."})]}):i.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"rounded-full bg-gray-100 w-14 h-14 flex items-center justify-center mx-auto mb-4",children:r==="all"?e.jsx(R,{className:"h-7 w-7 text-gray-400"}):e.jsx(te,{className:"h-7 w-7 text-gray-400"})}),e.jsx("h3",{className:"text-base font-medium mb-2",children:r==="all"?"暂无盘点任务":"该时间段内暂无任务"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:r==="all"?"还没有创建过盘点任务，点击上方按钮开始第一次盘点":r==="7d"?"最近7天内没有创建盘点任务，可以尝试查看更长的时间范围":r==="30d"?"最近30天内没有创建盘点任务，可以尝试查看更长的时间范围":r==="90d"?"最近90天内没有创建盘点任务，可以尝试查看全部时间":"自定义时间范围内没有创建盘点任务，可以尝试查看全部时间"}),r==="all"?e.jsxs(d,{onClick:k,children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"创建第一个盘点任务"]}):e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(d,{variant:"outline",onClick:()=>I("all"),children:"查看全部时间"}),e.jsxs(d,{onClick:k,children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"创建新任务"]})]})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"space-y-2 pr-2",style:{maxHeight:"300px",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#d1d5db #f3f4f6"},children:i.map(s=>{const t=B(s.requestedScopeType,s.requestedScopeValues),l=t.icon;return e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-md hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{className:"h-4 w-4 text-gray-600 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.text}),$(s.status)]}),e.jsxs("div",{className:"flex items-center space-x-3 mt-0.5",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.totalEmployeesToProcess,"人"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.requestedDurationDays,"天"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString("zh-CN")})]})]})]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>L(s.id),className:"ml-2 flex-shrink-0 text-xs px-2 py-1 h-7",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),"详情"]})]},s.id)})}),i.length>3&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-4 bg-gradient-to-t from-white to-transparent pointer-events-none"})]})})]})]})})};export{je as default};
