import{az as n,aA as i}from"./index-CVM7gAPX.js";class c{async initiate(o){try{console.log("发起盘点验证:",o);const r=await n(`${i.BASE_URL}/verification/admin/batch`,{method:"POST",body:JSON.stringify(o)}),e=await r.json();if(!r.ok)throw new Error(e.error||"发起盘点验证失败");return e.data}catch(r){throw console.error("发起盘点验证失败:",r),r instanceof Error?r:new Error("发起盘点验证失败，请稍后重试")}}async getBatchStatus(o){try{console.log("获取批处理状态:",o);const r=await n(`${i.BASE_URL}/verification/batch/${o}/status`,{method:"GET"}),e=await r.json();if(!r.ok)throw new Error(e.error||"获取批处理状态失败");return e.data}catch(r){throw console.error("获取批处理状态失败:",r),r instanceof Error?r:new Error("获取批处理状态失败，请稍后重试")}}async getEmployeeInfo(o){try{console.log("获取员工确认信息");const r=await n(`${i.BASE_URL}/verification/info?token=${encodeURIComponent(o)}`,{method:"GET",auth:!1}),e=await r.json();if(!r.ok){const t=new Error(e.error||"获取员工确认信息失败");throw t.status=r.status,t}return e.data}catch(r){throw console.error("获取员工确认信息失败:",r),r instanceof Error?r:new Error("获取确认信息失败，请检查链接是否有效")}}async submitVerification(o,r){try{console.log("提交确认结果:",r);const e=await n(`${i.BASE_URL}/verification/submit?token=${encodeURIComponent(o)}`,{method:"POST",body:JSON.stringify(r),auth:!1});if(!e.ok){const t=await e.json();throw new Error(t.error||"提交确认结果失败")}}catch(e){throw console.error("提交确认结果失败:",e),e instanceof Error?e:new Error("提交确认结果失败，请稍后重试")}}async reactivateVerification(o){try{console.log("重新激活确认, token:",o);const r=await n(`${i.BASE_URL}/verification/reactivate`,{method:"POST",body:JSON.stringify({token:o}),auth:!1}),e=await r.json();if(!r.ok)throw new Error(e.error||"重新激活确认失败");return e}catch(r){throw console.error("重新激活确认失败:",r),r instanceof Error?r:new Error("重新激活确认失败，请稍后重试")}}async getResults(o){try{console.log("获取盘点结果, batchId:",o);const r=`${i.BASE_URL}/verification/admin/phone-status?batch_id=${o}`,e=await n(r,{method:"GET"}),t=await e.json();if(!e.ok)throw new Error(t.error||"获取盘点结果失败");return t.data}catch(r){if(console.error("获取盘点结果失败:",r),r instanceof Error&&(r.message.includes("404")||r.message.includes("fetch")))return console.warn("盘点结果接口暂未实现或网络错误，返回空数据结构"),{summary:{totalPhonesCount:0,confirmedPhonesCount:0,reportedIssuesCount:0,pendingPhonesCount:0,newlyReportedPhonesCount:0},confirmedPhones:[],pendingUsers:[],reportedIssues:[],unlistedNumbers:[]};throw r instanceof Error?r:new Error("获取盘点结果失败，请稍后重试")}}async getBatchList(o){try{console.log("获取批处理任务列表",o);const r=new URLSearchParams;o!=null&&o.page&&r.append("page",o.page.toString()),o!=null&&o.limit&&r.append("limit",o.limit.toString()),o!=null&&o.status&&r.append("status",o.status),o!=null&&o.sortBy&&r.append("sortBy",o.sortBy),o!=null&&o.sortOrder&&r.append("sortOrder",o.sortOrder),o!=null&&o.createdAfter&&r.append("createdAfter",o.createdAfter),o!=null&&o.createdBefore&&r.append("createdBefore",o.createdBefore);const e=`${i.BASE_URL}/verification/admin/batch-tasks${r.toString()?`?${r.toString()}`:""}`,t=await n(e,{method:"GET"}),s=await t.json();if(!t.ok)throw new Error(s.error||"获取批处理任务列表失败");return s.data.tasks}catch(r){if(console.error("获取批处理任务列表失败:",r),r instanceof Error&&r.message.includes("404"))return console.warn("批处理列表接口暂未实现，返回空数组"),[];throw r}}async resendFailedEmails(o,r){try{console.log(`补发邮件: batchId=${o}, employeeIds=${r==null?void 0:r.join(",")}`);const e=await n(`${i.BASE_URL}/verification/batch/${o}/resend`,{method:"POST",body:JSON.stringify({employeeIds:r})}),t=await e.json();if(!e.ok)throw new Error(t.error||"补发邮件失败");return t.data}catch(e){throw console.error("补发失败的验证邮件失败:",e),e instanceof Error?e:new Error("补发失败的验证邮件失败，请稍后重试")}}}const w=new c;export{w as v};
