import{y as U,j as e,Z as W,R as z,ad as X,u as Y,b as ee,a4 as se,aw as g,a5 as B,C as E,d as w,e as I,f as J,g as O,B as R,af as te,a6 as L,aq as G,r as re,a7 as T,ax as ae,ay as ne,P as ie,ac as S}from"./index-CtZ2PKlW.js";import{v as q}from"./verificationService-B0VH615L.js";import{a as K,C as le}from"./clock-CTH7TFfH.js";const ce=[{value:"带班",label:"带班"},{value:"水军",label:"水军"},{value:"测试",label:"测试"},{value:"新媒体",label:"新媒体"},{value:"其他",label:"其他"}],P=({value:a,onValueChange:n,placeholder:s="请选择",className:i="h-9",options:o=ce})=>{const[t,h]=U.useState(!1),u=U.useRef(null);U.useEffect(()=>{const l=y=>{u.current&&!u.current.contains(y.target)&&h(!1)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[]);const N=o.find(l=>l.value===a);return e.jsxs("div",{ref:u,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>h(!t),className:`${i} w-full px-3 py-2 text-sm border border-gray-300 rounded-md bg-white text-left flex items-center justify-between hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500`,children:[e.jsx("span",{className:N?"text-gray-900 font-normal":"text-gray-500 font-normal",children:N?N.label:s}),e.jsx(W,{className:`h-3.5 w-3.5 text-gray-400 transition-transform ${t?"rotate-180":""}`})]}),t&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-50 max-h-60 overflow-auto",children:o.map(l=>e.jsx("button",{type:"button",onClick:()=>{n(l.value),h(!1)},className:`w-full px-3 py-2 text-sm text-left hover:bg-gray-100 focus:outline-none focus:bg-gray-100 font-normal ${a===l.value?"bg-blue-50 text-blue-600":"text-gray-900"}`,children:l.label},l.value))})]})},Q=a=>{let n;const s=new Set,i=(l,y)=>{const v=typeof l=="function"?l(n):l;if(!Object.is(v,n)){const p=n;n=y??(typeof v!="object"||v===null)?v:Object.assign({},n,v),s.forEach(j=>j(n,p))}},o=()=>n,u={setState:i,getState:o,getInitialState:()=>N,subscribe:l=>(s.add(l),()=>s.delete(l))},N=n=a(i,o,u);return u},me=a=>a?Q(a):Q,oe=a=>a;function de(a,n=oe){const s=z.useSyncExternalStore(a.subscribe,()=>n(a.getState()),()=>n(a.getInitialState()));return z.useDebugValue(s),s}const Z=a=>{const n=me(a),s=i=>de(n,i);return Object.assign(s,n),s},ue=a=>a?Z(a):Z;function xe(a,n){let s;try{s=a()}catch{return}return{getItem:o=>{var t;const h=N=>N===null?null:JSON.parse(N,void 0),u=(t=s.getItem(o))!=null?t:null;return u instanceof Promise?u.then(h):h(u)},setItem:(o,t)=>s.setItem(o,JSON.stringify(t,void 0)),removeItem:o=>s.removeItem(o)}}const F=a=>n=>{try{const s=a(n);return s instanceof Promise?s:{then(i){return F(i)(s)},catch(i){return this}}}catch(s){return{then(i){return this},catch(i){return F(i)(s)}}}},he=(a,n)=>(s,i,o)=>{let t={storage:xe(()=>localStorage),partialize:d=>d,version:0,merge:(d,c)=>({...c,...d}),...n},h=!1;const u=new Set,N=new Set;let l=t.storage;if(!l)return a((...d)=>{console.warn(`[zustand persist middleware] Unable to update item '${t.name}', the given storage is currently unavailable.`),s(...d)},i,o);const y=()=>{const d=t.partialize({...i()});return l.setItem(t.name,{state:d,version:t.version})},v=o.setState;o.setState=(d,c)=>{v(d,c),y()};const p=a((...d)=>{s(...d),y()},i,o);o.getInitialState=()=>p;let j;const k=()=>{var d,c;if(!l)return;h=!1,u.forEach(x=>{var b;return x((b=i())!=null?b:p)});const C=((c=t.onRehydrateStorage)==null?void 0:c.call(t,(d=i())!=null?d:p))||void 0;return F(l.getItem.bind(l))(t.name).then(x=>{if(x)if(typeof x.version=="number"&&x.version!==t.version){if(t.migrate){const b=t.migrate(x.state,x.version);return b instanceof Promise?b.then(_=>[!0,_]):[!0,b]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,x.state];return[!1,void 0]}).then(x=>{var b;const[_,A]=x;if(j=t.merge(A,(b=i())!=null?b:p),s(j,!0),_)return y()}).then(()=>{C==null||C(j,void 0),j=i(),h=!0,N.forEach(x=>x(j))}).catch(x=>{C==null||C(void 0,x)})};return o.persist={setOptions:d=>{t={...t,...d},d.storage&&(l=d.storage)},clearStorage:()=>{l==null||l.removeItem(t.name)},getOptions:()=>t,rehydrate:()=>k(),hasHydrated:()=>h,onHydrate:d=>(u.add(d),()=>{u.delete(d)}),onFinishHydration:d=>(N.add(d),()=>{N.delete(d)})},t.skipHydration||k(),j||p},Ne=he,fe=a=>ue()(Ne(n=>({verifiedNumbers:[],unlistedNumbers:[],setVerifiedNumbers:s=>n({verifiedNumbers:s}),setUnlistedNumbers:s=>n({unlistedNumbers:s}),updateVerifiedNumber:(s,i)=>n(o=>({verifiedNumbers:o.verifiedNumbers.map((t,h)=>h===s?{...t,...i}:t)})),updateUnlistedNumber:(s,i)=>n(o=>({unlistedNumbers:o.unlistedNumbers.map((t,h)=>h===s?{...t,...i}:t)})),addUnlistedNumber:()=>n(s=>({unlistedNumbers:[...s.unlistedNumbers,{phoneNumber:"",purpose:"",userComment:""}]})),removeUnlistedNumber:s=>n(i=>({unlistedNumbers:i.unlistedNumbers.filter((o,t)=>t!==s)})),clearAll:()=>n({verifiedNumbers:[],unlistedNumbers:[]})}),{name:`verification-${a}`,storage:{getItem:n=>{const s=sessionStorage.getItem(n);return s?JSON.parse(s):null},setItem:(n,s)=>{sessionStorage.setItem(n,JSON.stringify(s))},removeItem:n=>{sessionStorage.removeItem(n)}}})),pe=()=>{const{token:a}=X(),n=Y(),[s,i]=U.useState(!1),o=[{value:"封号/停机",label:"封号/停机"},{value:"丢失/遗失",label:"丢失/遗失"},{value:"号码已注销",label:"号码已注销"},{value:"其他",label:"其他"}],t=U.useMemo(()=>a?fe(a):null,[a]),h=t==null?void 0:t(),{verifiedNumbers:u,unlistedNumbers:N,setVerifiedNumbers:l,setUnlistedNumbers:y,updateVerifiedNumber:v,updateUnlistedNumber:p,addUnlistedNumber:j,removeUnlistedNumber:k,clearAll:d}=h||{verifiedNumbers:[],unlistedNumbers:[],setVerifiedNumbers:()=>{},setUnlistedNumbers:()=>{},updateVerifiedNumber:()=>{},updateUnlistedNumber:()=>{},addUnlistedNumber:()=>{},removeUnlistedNumber:()=>{},clearAll:()=>{}},{data:c,isLoading:C,error:x}=ee({queryKey:["verification","employee",a],queryFn:()=>{if(!a)throw new Error("缺少验证令牌");return q.getEmployeeInfo(a)},enabled:!!a,retry:!1}),b=se({mutationFn:r=>{if(!a)throw new Error("缺少验证令牌");return q.submitVerification(a,r)},onSuccess:()=>{i(!0),d(),S({title:"提交成功",description:"您的反馈已成功提交，感谢您的配合！"})},onError:r=>{S({title:"提交失败",description:r instanceof Error?r.message:"提交失败，请稍后重试",variant:"destructive"})}});U.useEffect(()=>{if(c!=null&&c.phoneNumbers&&Array.isArray(c.phoneNumbers)&&u.length===0){const r=c.phoneNumbers.map(m=>({mobileNumberId:m.id,action:g.NOT_SELECTED,purpose:m.purpose||"",userComment:m.userComment||""}));l(r)}},[c,u.length,l]);const _=()=>{for(const r of u){if(r.action===g.NOT_SELECTED)return S({title:"表单验证失败",description:"请为所有号码选择使用状态（确认使用或报告问题）",variant:"destructive"}),!1;if(r.action===g.CONFIRM_USAGE){if(!r.purpose.trim())return S({title:"表单验证失败",description:"请填写确认使用号码的用途说明",variant:"destructive"}),!1}else if(r.action===g.REPORT_ISSUE&&!r.userComment)return S({title:"表单验证失败",description:"请选择问题类型",variant:"destructive"}),!1}for(const r of N){if(!r.phoneNumber.trim()||!r.purpose.trim())return S({title:"表单验证失败",description:"请完整填写新增号码的信息",variant:"destructive"}),!1;if(!/^1[3-9]\d{9}$/.test(r.phoneNumber))return S({title:"表单验证失败",description:"请输入正确的手机号码格式",variant:"destructive"}),!1}return!0},A=()=>{if(!_())return;const m={verifiedNumbers:u.filter(f=>f.action!==g.NOT_SELECTED),unlistedNumbersReported:N};b.mutate(m)};return C?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"正在加载确认信息..."})]})}):x||!c?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs(E,{className:"w-full max-w-md",children:[e.jsx(w,{children:e.jsxs(I,{className:"flex items-center text-red-600",children:[e.jsx(J,{className:"h-5 w-5 mr-2"}),"访问失败"]})}),e.jsxs(O,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:x instanceof Error?x.message:"无法获取确认信息，请检查链接是否有效或已过期"}),e.jsx(R,{onClick:()=>n("/"),variant:"outline",className:"w-full",children:"返回首页"})]})]})}):s?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs(E,{className:"w-full max-w-md",children:[e.jsx(w,{children:e.jsxs(I,{className:"flex items-center text-green-600",children:[e.jsx(K,{className:"h-5 w-5 mr-2"}),"提交成功"]})}),e.jsx(O,{children:e.jsx("p",{className:"text-gray-600 mb-4",children:"您的反馈已成功提交，感谢您的配合！"})})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-6",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs(E,{className:"mb-6",children:[e.jsxs(w,{className:"pb-4",children:[e.jsxs(I,{className:"flex items-center text-lg font-medium text-gray-900",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"手机号码使用确认"]}),e.jsx(L,{className:"text-sm text-gray-600 mt-1",children:"请确认您当前使用的手机号码信息，如有问题请及时反馈"})]}),e.jsx(O,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"text-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"姓名："}),e.jsx("span",{className:"ml-1",children:c.employeeName})]}),e.jsxs("div",{className:"flex items-center text-gray-700",children:[e.jsx(le,{className:"h-3.5 w-3.5 mr-1 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-900",children:"截止时间："}),e.jsxs("span",{className:"ml-1",children:[new Date(c.expiresAt).toLocaleDateString("zh-CN")," 23:59",e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:"（超时未确认的号码可能会停机）"})]})]})]})})]}),e.jsxs(E,{className:"mb-6",children:[e.jsxs(w,{className:"pb-4",children:[e.jsx(I,{className:"text-lg font-medium text-gray-900",children:"请确认以下号码的使用情况"}),e.jsx(L,{className:"text-sm text-gray-600 mt-1",children:"请逐一确认每个号码的使用状态，并填写相关信息"}),(()=>{const r=u.length,m=u.filter(f=>f.action!==g.NOT_SELECTED).length;return r>0&&m<r?e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["已确认 ",m,"/",r," 个号码"]}):null})()]}),e.jsx(O,{className:"space-y-4",children:((c==null?void 0:c.phoneNumbers)||[]).map((r,m)=>{var $,H,M;const f=($=u[m])==null?void 0:$.action,V=f===g.NOT_SELECTED;return e.jsxs("div",{className:`border rounded-lg p-4 ${V?"border-orange-200 bg-orange-50/20":"border-gray-200 bg-gray-50/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-50 rounded-full flex items-center justify-center",children:e.jsx(G,{className:"h-3.5 w-3.5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:r.phoneNumber}),r.department&&e.jsx(re,{variant:"secondary",className:"text-xs mt-0.5 font-normal",children:r.department})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[V&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"待确认"}),e.jsxs("div",{className:"text-xs text-gray-500 bg-white px-2 py-1 rounded font-normal",children:[m+1,"/",((c==null?void 0:c.phoneNumbers)||[]).length]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsxs(T,{className:"text-xs font-medium text-gray-700 mb-2 block",children:["使用状态 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(R,{variant:f===g.CONFIRM_USAGE?"default":"outline",size:"sm",onClick:()=>v(m,{action:g.CONFIRM_USAGE,userComment:""}),className:`h-9 text-xs font-medium ${f===g.CONFIRM_USAGE?"bg-green-600 hover:bg-green-700 text-white":""}`,children:[e.jsx(K,{className:"h-3 w-3 mr-1.5"}),"确认使用"]}),e.jsxs(R,{variant:f===g.REPORT_ISSUE?"destructive":"outline",size:"sm",onClick:()=>v(m,{action:g.REPORT_ISSUE,purpose:""}),className:"h-9 text-xs font-medium",children:[e.jsx(J,{className:"h-3 w-3 mr-1.5"}),"报告问题"]})]})]}),e.jsx("div",{className:"lg:col-span-2",children:f===g.NOT_SELECTED?e.jsx("div",{className:"h-9 flex items-center text-xs text-orange-600 italic",children:"← 请先选择使用状态"}):f===g.REPORT_ISSUE?e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"text-xs font-medium text-red-700 mb-2 block",children:["问题说明 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(P,{value:((H=u[m])==null?void 0:H.userComment)||"",onValueChange:D=>v(m,{userComment:D}),options:o})]}):e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"text-xs font-medium text-gray-700 mb-2 block",children:["用途说明 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(P,{value:((M=u[m])==null?void 0:M.purpose)||"",onValueChange:D=>v(m,{purpose:D})})]})})]})]},r.id)})})]}),((c==null?void 0:c.previouslyReportedUnlisted)||[]).length>0&&e.jsxs(E,{className:"mb-6",children:[e.jsx(w,{className:"pb-3",children:e.jsx(I,{className:"text-lg font-medium text-gray-900",children:"您之前上报的未列出号码"})}),e.jsx(O,{children:e.jsx("div",{className:"space-y-2",children:((c==null?void 0:c.previouslyReportedUnlisted)||[]).map((r,m)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"h-3.5 w-3.5 text-gray-500"}),e.jsx("span",{className:"font-medium text-sm text-gray-900",children:r.phoneNumber}),e.jsxs("span",{className:"text-sm text-gray-600",children:["- ",r.purpose]})]}),e.jsx("span",{className:"text-xs text-gray-500 font-normal",children:r.reportedAt?new Date(r.reportedAt).toLocaleDateString("zh-CN"):""})]},m))})})]}),e.jsxs(E,{className:"mb-6",children:[e.jsxs(w,{className:"pb-4",children:[e.jsx(I,{className:"text-lg font-medium text-gray-900",children:"上报未列出的号码"}),e.jsx(L,{className:"text-sm text-gray-600 mt-1",children:"如果您正在使用的号码未在上述列表中，请在此添加"})]}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-4",children:[N.map((r,m)=>e.jsx("div",{className:"border border-gray-100 rounded-lg p-4 bg-gray-50/20",children:e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(T,{className:"text-xs font-medium text-gray-700 mb-2 block",children:["手机号码 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ae,{value:r.phoneNumber,onChange:f=>p(m,{phoneNumber:f.target.value}),placeholder:"请输入11位手机号",className:"h-9 text-sm"})]}),e.jsxs("div",{children:[e.jsxs(T,{className:"text-xs font-medium text-gray-700 mb-2 block",children:["用途说明 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(P,{value:r.purpose,onValueChange:f=>p(m,{purpose:f})})]})]}),e.jsx("div",{className:"pt-7",children:e.jsx(R,{variant:"outline",size:"sm",onClick:()=>k(m),className:"h-9 px-3",children:e.jsx(ne,{className:"h-3.5 w-3.5"})})})]})},m)),e.jsxs(R,{variant:"outline",onClick:j,className:"w-full h-10 mt-5 text-sm font-medium",children:[e.jsx(ie,{className:"h-3.5 w-3.5 mr-2"}),"添加号码"]})]})})]}),e.jsx("div",{className:"flex flex-col items-center space-y-3",children:(()=>{const r=u.filter(f=>f.action===g.NOT_SELECTED).length,m=b.isPending||r>0;return e.jsxs(e.Fragment,{children:[r>0&&e.jsxs("div",{className:"text-sm text-orange-600",children:["还有 ",r," 个号码待确认"]}),e.jsxs(R,{onClick:A,disabled:m,size:"lg",className:`px-8 text-sm font-medium ${m?"opacity-60":""}`,children:[b.isPending&&e.jsx(B,{className:"h-4 w-4 mr-2 animate-spin"}),"提交确认结果"]})]})})()})]})})};export{pe as default};
