import{az as n,aA as i}from"./index-CtZ2PKlW.js";class c{async initiate(r){try{console.log("发起盘点验证:",r);const o=await n(`${i.BASE_URL}/verification/admin/batch`,{method:"POST",body:JSON.stringify(r)}),e=await o.json();if(!o.ok)throw new Error(e.error||"发起盘点验证失败");return e.data}catch(o){throw console.error("发起盘点验证失败:",o),o instanceof Error?o:new Error("发起盘点验证失败，请稍后重试")}}async getBatchStatus(r){try{console.log("获取批处理状态:",r);const o=await n(`${i.BASE_URL}/verification/batch/${r}/status`,{method:"GET"}),e=await o.json();if(!o.ok)throw new Error(e.error||"获取批处理状态失败");return e.data}catch(o){throw console.error("获取批处理状态失败:",o),o instanceof Error?o:new Error("获取批处理状态失败，请稍后重试")}}async getEmployeeInfo(r){try{console.log("获取员工确认信息");const o=await n(`${i.BASE_URL}/verification/info?token=${encodeURIComponent(r)}`,{method:"GET",auth:!1}),e=await o.json();if(!o.ok)throw new Error(e.error||"获取员工确认信息失败");return e.data}catch(o){throw console.error("获取员工确认信息失败:",o),o instanceof Error?o:new Error("获取确认信息失败，请检查链接是否有效")}}async submitVerification(r,o){try{console.log("提交确认结果:",o);const e=await n(`${i.BASE_URL}/verification/submit?token=${encodeURIComponent(r)}`,{method:"POST",body:JSON.stringify(o),auth:!1});if(!e.ok){const t=await e.json();throw new Error(t.error||"提交确认结果失败")}}catch(e){throw console.error("提交确认结果失败:",e),e instanceof Error?e:new Error("提交确认结果失败，请稍后重试")}}async getResults(r){try{console.log("获取盘点结果, batchId:",r);const o=`${i.BASE_URL}/verification/admin/phone-status?batch_id=${r}`,e=await n(o,{method:"GET"}),t=await e.json();if(!e.ok)throw new Error(t.error||"获取盘点结果失败");return t.data}catch(o){if(console.error("获取盘点结果失败:",o),o instanceof Error&&(o.message.includes("404")||o.message.includes("fetch")))return console.warn("盘点结果接口暂未实现或网络错误，返回空数据结构"),{summary:{totalPhonesCount:0,confirmedPhonesCount:0,reportedIssuesCount:0,pendingPhonesCount:0,newlyReportedPhonesCount:0},confirmedPhones:[],pendingUsers:[],reportedIssues:[],unlistedNumbers:[]};throw o instanceof Error?o:new Error("获取盘点结果失败，请稍后重试")}}async getBatchList(r){try{console.log("获取批处理任务列表",r);const o=new URLSearchParams;r!=null&&r.page&&o.append("page",r.page.toString()),r!=null&&r.limit&&o.append("limit",r.limit.toString()),r!=null&&r.status&&o.append("status",r.status),r!=null&&r.sortBy&&o.append("sortBy",r.sortBy),r!=null&&r.sortOrder&&o.append("sortOrder",r.sortOrder),r!=null&&r.createdAfter&&o.append("createdAfter",r.createdAfter),r!=null&&r.createdBefore&&o.append("createdBefore",r.createdBefore);const e=`${i.BASE_URL}/verification/admin/batch-tasks${o.toString()?`?${o.toString()}`:""}`,t=await n(e,{method:"GET"}),s=await t.json();if(!t.ok)throw new Error(s.error||"获取批处理任务列表失败");return s.data.tasks}catch(o){if(console.error("获取批处理任务列表失败:",o),o instanceof Error&&o.message.includes("404"))return console.warn("批处理列表接口暂未实现，返回空数组"),[];throw o}}async resendFailedEmails(r,o){try{console.log(`补发邮件: batchId=${r}, employeeIds=${o==null?void 0:o.join(",")}`);const e=await n(`${i.BASE_URL}/verification/batch/${r}/resend`,{method:"POST",body:JSON.stringify({employeeIds:o})}),t=await e.json();if(!e.ok)throw new Error(t.error||"补发邮件失败");return t.data}catch(e){throw console.error("补发失败的验证邮件失败:",e),e instanceof Error?e:new Error("补发失败的验证邮件失败，请稍后重试")}}}const w=new c;export{w as v};
